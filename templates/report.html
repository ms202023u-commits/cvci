<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report News - Civic Lens Solutions</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='civic-lens-design-system.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='ultra-index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='report-unified.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='unified-header-footer.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Animated Background -->
    <div class="background-animation">
        <div class="floating-shapes">
            <div class="shape shape-1"></div>
            <div class="shape shape-2"></div>
            <div class="shape shape-3"></div>
        </div>
    </div>

    <!-- Unified Header -->
    {% include 'includes/unified-header.html' %}

    <!-- Main Content -->
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">
                <i class="fas fa-flag"></i>
                Report News & Events
            </h1>
            <p class="page-subtitle">Help build a more informed community by reporting suspicious news or critical events</p>
        </div>

        <!-- Report Form -->
        <div class="report-container">
            <form id="reportForm" class="report-form">
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-info-circle"></i>
                        Report Information
                    </h3>
                    
                    <div class="form-group">
                        <label for="reportType" class="form-label">Report Type</label>
                        <select id="reportType" name="reportType" class="form-select" required>
                            <option value="">Select report type...</option>
                            <option value="fake_news">üö´ Fake News</option>
                            <option value="critical_event">‚ö†Ô∏è Critical Event</option>
                            <option value="misinformation">üì¢ Misinformation</option>
                            <option value="suspicious_source">üîç Suspicious Source</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="newsTitle" class="form-label">News Title or Headline</label>
                        <input type="text" id="newsTitle" name="newsTitle" class="form-input" 
                               placeholder="Enter the news headline or title..." required>
                    </div>

                    <div class="form-group">
                        <label for="newsContent" class="form-label">Content or Description</label>
                        <textarea id="newsContent" name="newsContent" class="form-textarea" rows="6"
                                  placeholder="Provide details about the news content or event..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="newsUrl" class="form-label">Source URL (Optional)</label>
                        <input type="url" id="newsUrl" name="newsUrl" class="form-input" 
                               placeholder="https://example.com/news-article">
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Location Information
                    </h3>
                    
                    <div class="location-controls">
                        <button type="button" class="location-btn" onclick="getCurrentLocation()">
                            <i class="fas fa-crosshairs"></i>
                            Use Current Location
                        </button>
                        <span class="location-divider">or</span>
                        <input type="text" id="manualLocation" class="form-input" 
                               placeholder="Enter city, address, or location...">
                    </div>
                    
                    <div id="locationDisplay" class="location-display" style="display: none;">
                        <i class="fas fa-map-pin"></i>
                        <span id="locationText"></span>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-shield-check"></i>
                        Verification Details
                    </h3>
                    
                    <div class="form-group">
                        <label for="evidenceDescription" class="form-label">Evidence or Reasoning</label>
                        <textarea id="evidenceDescription" name="evidenceDescription" class="form-textarea" rows="4"
                                  placeholder="Explain why you believe this is fake news or describe the critical event..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="verifyAccuracy" name="verifyAccuracy" required>
                            <span class="checkmark"></span>
                            I verify that the information provided is accurate to the best of my knowledge
                        </label>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="clearForm()">
                        <i class="fas fa-times"></i>
                        Clear Form
                    </button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-paper-plane"></i>
                        Submit Report
                    </button>
                </div>
            </form>
        </div>

        <!-- Recent Reports -->
        <div class="recent-reports">
            <h2 class="section-title">
                <i class="fas fa-history"></i>
                Recent Community Reports
            </h2>
            <div id="recentReportsList" class="reports-grid">
                <!-- Reports will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Unified Footer -->
    {% include 'includes/unified-footer.html' %}

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script src="{{ url_for('static', filename='mobile-2025.js') }}"></script>
    <script>
        // Report form functionality
        document.getElementById('reportForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const reportData = Object.fromEntries(formData.entries());
            
            // Add location data if available
            const locationText = document.getElementById('locationText').textContent;
            if (locationText) {
                reportData.location = locationText;
            }
            
            try {
                const response = await fetch('/report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(reportData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showSuccessMessage('Report submitted successfully!');
                    clearForm();
                    loadRecentReports();
                } else {
                    showErrorMessage(result.error || 'Failed to submit report');
                }
            } catch (error) {
                showErrorMessage('Network error. Please try again.');
            }
        });

        function clearForm() {
            document.getElementById('reportForm').reset();
            document.getElementById('locationDisplay').style.display = 'none';
        }

        function showSuccessMessage(message) {
            // Implementation for success message
            alert(message); // Temporary implementation
        }

        function showErrorMessage(message) {
            // Implementation for error message
            alert(message); // Temporary implementation
        }

        // Load recent reports on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadRecentReports();
        });

        async function loadRecentReports() {
            try {
                const response = await fetch('/api/recent-reports');
                const reports = await response.json();
                
                const reportsContainer = document.getElementById('recentReportsList');
                reportsContainer.innerHTML = reports.map(report => `
                    <div class="report-card">
                        <div class="report-header">
                            <span class="report-type ${report.report_type}">${getReportTypeIcon(report.report_type)} ${report.report_type.replace('_', ' ')}</span>
                            <span class="report-time">${formatTime(report.timestamp)}</span>
                        </div>
                        <h4 class="report-title">${report.title}</h4>
                        <p class="report-content">${report.content.substring(0, 150)}...</p>
                        <div class="report-footer">
                            <span class="report-location"><i class="fas fa-map-pin"></i> ${report.location || 'Unknown'}</span>
                            <span class="credibility-score">Score: ${report.credibility_score || 'N/A'}</span>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load recent reports:', error);
            }
        }

        function getReportTypeIcon(type) {
            const icons = {
                'fake_news': 'üö´',
                'critical_event': '‚ö†Ô∏è',
                'misinformation': 'üì¢',
                'suspicious_source': 'üîç'
            };
            return icons[type] || 'üì∞';
        }

        function formatTime(timestamp) {
            return new Date(timestamp).toLocaleDateString();
        }
    </script>

    <!-- Unified Footer -->
    <footer class="ultra-footer">
        <div class="footer-background">
            <div class="footer-gradient"></div>
        </div>
        <div class="section-container">
            <div class="footer-content">
                <div class="footer-main">
                    <div class="footer-brand">
                        <div class="brand-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="brand-text">
                            <span class="brand-name">Civic Lens Solutions</span>
                            <span class="brand-tagline">Advanced News Verification Platform</span>
                        </div>
                    </div>
                    <p class="footer-description">
                        Empowering informed citizenship through cutting-edge AI technology, 
                        real-time news verification, and community-driven fact-checking.
                    </p>
                    <div class="social-links">
                        <a href="#" class="social-link" aria-label="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="Facebook">
                            <i class="fab fa-facebook"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="LinkedIn">
                            <i class="fab fa-linkedin"></i>
                        </a>
                        <a href="#" class="social-link" aria-label="GitHub">
                            <i class="fab fa-github"></i>
                        </a>
                    </div>
                </div>
                
                <div class="footer-links">
                    <div class="link-group">
                        <h4>Platform</h4>
                        <ul>
                            <li><a href="/enhanced-chatbot">Enhanced AI Chatbots</a></li>
                            <li><a href="/ultra-map">Ultra News Map</a></li>
                            <li><a href="/chatbot">Classic Chatbot</a></li>
                            <li><a href="/report">Community Reporting</a></li>
                        </ul>
                    </div>
                    
                    <div class="link-group">
                        <h4>Features</h4>
                        <ul>
                            <li><a href="/#features">AI Analysis</a></li>
                            <li><a href="/#features">Real-time Mapping</a></li>
                            <li><a href="/#features">Credibility Scoring</a></li>
                            <li><a href="/#features">Community Verification</a></li>
                        </ul>
                    </div>
                    
                    <div class="link-group">
                        <h4>Resources</h4>
                        <ul>
                            <li><a href="/#about">About Us</a></li>
                            <li><a href="/#contact">Contact</a></li>
                            <li><a href="/#privacy">Privacy Policy</a></li>
                            <li><a href="/#terms">Terms of Service</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="footer-copyright">
                    <p>&copy; 2025 Civic Lens Solutions. All rights reserved.</p>
                    <p>Powered by advanced AI technology and community collaboration.</p>
                </div>
                <div class="footer-badges">
                    <div class="badge">
                        <i class="fas fa-shield-alt"></i>
                        <span>Secure</span>
                    </div>
                    <div class="badge">
                        <i class="fas fa-lock"></i>
                        <span>Private</span>
                    </div>
                    <div class="badge">
                        <i class="fas fa-check-circle"></i>
                        <span>Verified</span>
                    </div>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>
